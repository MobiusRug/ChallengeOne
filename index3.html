<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel = "stylesheet" href = "style.css">
    <title>CriptoTrix</title>
    <!--<audio id = "audio" src = "the-matrix-trinity-jump-sound-fx-plain-single-77358.mp3"></audio>-->
    <audio id = "audio" src = "matrixsound.mp3"></audio>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">
</head>
<body>

    
    <div class = "container1">
        <img src="logo.png" alt="" id="logo">
        <textarea id = "input" class = "texto" rows="30" cols="50" placeholder="Digite seu texto"></textarea>
        <br>
        <img src = "exclamation-16.png" id = "exclamation">
        <p>Apenas min√∫sculas e sem acento</p>
        <br>
        <button id = "criptografar" class = "button">&#128309  Criptografar </button>
        <button id = "descriptografar" class = "button">&#128308  Descriptografar </button>
    </div>
 
    <div class = "container2">
        <img src = matrix.gif id = "matrix">
    </div>
    <div>
        <button id = "copia" class="button">Copiar</button>
    </div>

    <script>
        var input = document.querySelector("#input");
        var output = document.querySelector('.container2')
        var audio = document.getElementById("audio");

        var buttonCopia = document.querySelector('#copia');
        //buttonCopia.style.visibility = "hidden";



        function pause(){
            audio.pause();
        }
        

        function criptografa(){
            var texto = input.value;
            var mapObj = {
                a:"ai",
                e:"enter",
                i:"imes",
                o:"ober",
                u:"ufat",
            };
            var textoCriptografado = texto.replace(/a|e|i|o|u/gi, function(match){
                return mapObj[match];
            } )  
            //try add if document.getElementById is not null
            const image = document.getElementById('matrix');
            if(image !== null){
                audio.play();
                setTimeout(pause, 4000);
                image.addEventListener('transitionend', function() {
                image.style.display = 'none';
                //output.innerHTML = textoCriptografado;
                output.textContent = textoCriptografado;
                buttonCopia.style.visibility = "visible";

            });

            }else{
                output.textContent = textoCriptografado;
            }
            image.classList.add('hidden');
            output.classList.add('limitSize');
        }

        function descriptografa(){
            var texto = input.value
            var mapObj = {
                ai:"a",
                enter:"e",
                imes:"i",
                ober:"o",
                ufat:"u"
            };
            var textoDescriptografado = texto.replace(/ai|enter|imes|ober|ufat/gi, function(match){
                return mapObj[match];
            } )  
            const image = document.getElementById('matrix');
            if(image !== null){
                audio.play();
                setTimeout(pause, 4000);
                image.addEventListener('transitionend', function() {
                image.style.display = 'none';
                //output.innerHTML = textoCriptografado;
                output.textContent = textoDescriptografado;
                buttonCopia.style.visibility = "visible";

            });

            }else{
                output.textContent = textoDescriptografado;
            }
            image.classList.add('hidden');
            output.classList.add('limitSize');
        }

        function copia(){
            const texto = document.querySelector('.container2');
            const tempTexArea = document.createElement('textarea');
            tempTexArea.value = texto.textContent;
            document.body.appendChild(tempTexArea);
            tempTexArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTexArea);
            alert("Texto baixado da Matrix!");
        }
        
        var buttonCrip = document.querySelector('#criptografar');
        buttonCrip.addEventListener('click', criptografa);

        var buttonDescrip = document.querySelector('#descriptografar');
        buttonDescrip.addEventListener('click', descriptografa);

        buttonCopia.addEventListener('click', copia);

        window.onload = function() {
            input.value = '';
        }

        
    </script>
    
</body>
</html>